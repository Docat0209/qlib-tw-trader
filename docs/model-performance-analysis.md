# 模型訓練與回測深度分析報告

**生成時間**：2026-02-06
**回測期間**：2023W01 ~ 2025W52（156 週，約 3 年）
**股票池**：TW100（台股市值前 100 大）

---

## 執行摘要

### 核心結論

1. **訓練效果良好**：Valid ICIR = 1.43，超過 0.5 基準，但年度差異大（0.83 ~ 2.63）
2. **實盤預測能力無法確認**：Live IC p = 0.32，156 週數據仍不足以證明顯著
3. **超額報酬高度顯著**：累積 92% 超額報酬，p = 0.00013
4. **ICIR 衰減極為嚴重**：94.3% 衰減（1.43 → 0.08）
5. **需大量數據**：確認 Live IC 顯著需要 **409 週**（約 7.9 年）

### 風險警示

- Live IC 的 95% 信賴區間 [-0.005, 0.015] **包含 0**
- Valid-Live IC 相關性接近 **0**（r = -0.01），驗證期完全無法預測實盤
- 年度表現差異極大：2023 年超額不顯著（p=0.20），2024-2025 年顯著
- Live IC 正值率僅 **54.6%**（接近隨機 50%）

### 建議行動

1. **不應依賴 Live IC 做決策**：統計上等同於隨機
2. **超額報酬是唯一可信指標**：但需持續監控是否為運氣
3. **改進重點**：提升 Live IC 穩定性，而非追求更高 Valid IC

---

## 1. 計算方式說明

### 1.1 我們的 IC 定義

| 項目 | 實現方式 | 代碼位置 |
|------|---------|---------|
| **相關方法** | Spearman 秩相關 | `model_trainer.py:616` |
| **計算頻率** | 每日截面 → 取平均 | `groupby("datetime")` |
| **Label 定義** | `close[T+2]/close[T+1] - 1` | `model_trainer.py:256` |
| **Label 標準化** | CSRankNorm（排名百分位 [0,1]） | `model_trainer.py:314` |
| **最小股票數** | 10 支 | `if len(group) < 10: return nan` |

**計算公式**：
```
IC = E[Spearman(預測排名, 實際排名)]
   = 平均(每日截面的 Spearman 相關係數)
```

### 1.2 與文獻定義的差異

| 定義來源 | 相關方法 | 頻率 | Label | 可比較性 |
|---------|---------|------|-------|---------|
| **Grinold & Kahn** | Pearson | 年級 | 原始收益 | ❌ 不可比 |
| **Qlib 論文** | Spearman | 日級 | 原始收益 | ⚠️ 部分可比 |
| **我們** | Spearman | 日級 | 排名標準化 | - |

### 1.3 定義差異的數值影響

| 差異來源 | 對 IC 數值的影響 |
|---------|-----------------|
| Spearman vs Pearson | Spearman ↑ 5-15%（對離群值更穩健） |
| 日級 vs 年級 | 日級 ↓ 50-70%（噪音更多） |
| 排名 vs 收益 | 排名預測可提升 Sharpe 3 倍 |

**關鍵結論**：
- 我們的 IC 數值**不能直接與年級 IC 比較**
- 日級 IC 0.01-0.03 ≈ 年級 IC 0.03-0.10（等效換算）
- 應使用 **ICIR**（去隨機性指標）而非絕對 IC 值比較

---

## 2. 數據概覽（統計可信度指標）

### 2.1 IC 統計摘要（156 週）

| 指標 | Valid IC | Live IC | 差異說明 |
|------|----------|---------|---------|
| **平均值** | 0.0274 | 0.0051 | Live 降低 81.4% |
| **標準差** | 0.0192 | 0.0632 | Live 波動大 3.3 倍 |
| **ICIR** | **1.43** | **0.08** | 關鍵差異！Live 接近 0 |
| **正值比例** | 90.4% | 54.6% | Live 接近隨機 |
| **中位數** | 0.0288 | 0.0053 | |
| **Q1-Q3** | [0.014, 0.041] | [-0.031, 0.045] | Live 範圍更廣 |
| **最小值** | -0.026 | -0.249 | Live 有極端負值 |
| **最大值** | 0.077 | 0.158 | |

### 2.2 統計顯著性檢驗

| 假設檢驗 | t 統計量 | p 值 | 結論 |
|---------|---------|------|------|
| Valid IC > 0 | 17.83 | < 0.001 | ✅ **高度顯著** |
| Live IC > 0 | 1.00 | 0.318 | ❌ **不顯著** |
| 超額報酬 > 0 | 3.93 | 0.00013 | ✅ **高度顯著** |

**Live IC 95% 信賴區間**：[-0.005, 0.015]
- 區間**包含 0**，156 週數據仍無法確認 Live IC > 0

### 2.3 與文獻基準的正確比較

使用 **ICIR**（去隨機性）而非絕對 IC 值：

| 指標 | 我們的值 | 文獻基準 | 可比較？ | 評價 |
|------|---------|---------|---------|------|
| **Valid ICIR** | 1.43 | > 0.5 (Grinold) | ✅ 是 | ✅ **良好** |
| **Live ICIR** | 0.08 | > 0.5 (Grinold) | ✅ 是 | ❌ **失敗** |
| Live IC p 值 | 0.318 | < 0.05 | ✅ 是 | ❌ 不顯著 |
| 正值比例 | 54.6% | > 50% | ✅ 是 | ⚠️ 接近隨機 |

**ICIR 文獻基準**（Grinold & Kahn, 2000）：
- ICIR > 0.5：可用（usable）
- ICIR > 1.0：優秀（excellent）
- ICIR > 2.0：非常優秀

### 2.4 年度分解

| 年度 | Valid ICIR | Live ICIR | Live IC p | 超額報酬 | 超額 p |
|------|-----------|-----------|-----------|---------|--------|
| **2023** | 2.63 | -0.00 | 0.994 | 19.8% | 0.204 ❌ |
| **2024** | 0.83 | 0.10 | 0.458 | 25.3% | 0.014 ✅ |
| **2025** | 1.85 | 0.17 | 0.240 | 47.2% | 0.002 ✅ |

**年度差異的關鍵發現**：
- Valid ICIR 差異極大（0.83 ~ 2.63）
- **2023 年超額報酬統計不顯著**，可能是運氣
- 只有 2024-2025 年的超額報酬可確認為非隨機

---

## 3. IC Decay 深度分析

### 3.1 Decay 的統計特性

| 統計量 | 數值 | 說明 |
|--------|------|------|
| **平均 Decay** | 212% | 被極端值大幅拉高 |
| **中位數 Decay** | 87% | 更具代表性，但仍偏高 |
| **ICIR 衰減** | **94.3%** | 最重要的指標 |
| **Valid-Live 相關** | -0.01 | 幾乎完全無關 |

### 3.2 高 Decay 的原因分析

**三層問題分解**：

1. **Live IC 本身非常弱**
   - Live IC mean = 0.005（幾乎為 0）
   - Live ICIR = 0.08（遠低於 0.5 可用門檻）
   - 正值率 54.6%（接近擲硬幣）

2. **Live IC 波動極大**
   - Live IC std = 0.063
   - Valid IC std = 0.019
   - 波動比 = 3.3x

3. **驗證期無預測能力**
   - Valid-Live 相關 r = -0.01
   - **結論：Valid IC 完全無法預測 Live IC 表現**

### 3.3 正確的評估方式

| 錯誤做法 | 正確做法 |
|---------|---------|
| ❌ 看單週 IC Decay | ✅ 看 ICIR 衰減（94.3%） |
| ❌ 看平均 Decay（212%） | ✅ 看中位數 Decay（87%） |
| ❌ 比較絕對 IC 值 | ✅ 比較 ICIR 和 p 值 |

**文獻基準**（López de Prado, 2018）：
- IC Decay < 30%：良好
- IC Decay 30-50%：可接受
- IC Decay > 50%：需關注

**我們的狀況**：
- 中位數 Decay 87%：❌ **嚴重超標**
- ICIR 衰減 94.3%：❌ **幾乎完全失效**

---

## 4. 過擬合診斷

### 4.1 ICIR 衰減分析

```
ICIR 衰減 = (Valid ICIR - Live ICIR) / Valid ICIR
         = (1.43 - 0.08) / 1.43
         = 94.3%
```

**這是極為嚴重的衰減**：
- Valid IC 平均值 0.027，且穩定（std = 0.019）
- Live IC 平均值 0.005，且不穩定（std = 0.063）
- **穩定性的衰減（94.3%）遠超幅度衰減（81%）**

### 4.2 IC 弱但報酬強的矛盾

| 現象 | 數值 | 可能解釋 |
|------|------|---------|
| Live IC 幾乎為 0 | mean = 0.005, p = 0.32 | 排名預測精度接近隨機 |
| 超額報酬高度顯著 | p = 0.00013 | Top-K 放大微弱但正確的方向 |
| 3 年累積市場 | +84% | 強勁牛市放大效應 |

**Top-K 放大效應解析**：

1. **即使 IC 接近 0，只要略偏正**
   - IC = 0.005 表示預測與實際有微弱正相關
   - 每週 Top-10 可能比平均多 1-2 支好股票

2. **累積 156 週後**
   - 微小優勢累積成顯著超額報酬
   - 但這依賴牛市環境（負報酬市場會放大錯誤）

3. **風險**
   - 如果 IC 實際為 0，超額報酬可能是運氣
   - 需要更長期數據確認

### 4.3 診斷結論

| 診斷項目 | 閾值 | 我們的值 | 結論 |
|---------|------|---------|------|
| Valid ICIR | > 0.5 | 1.43 | ✅ 良好 |
| Live ICIR | > 0.5 | 0.08 | ❌ **失敗** |
| ICIR 衰減 | < 50% | 94.3% | ❌ **嚴重** |
| Live IC p | < 0.05 | 0.318 | ❌ 不顯著 |
| 超額報酬 p | < 0.05 | 0.00013 | ✅ **高度顯著** |
| Live IC 正值率 | > 60% | 54.6% | ❌ 接近隨機 |

**過擬合程度**：**嚴重**
- 訓練表現 → 實盤表現的轉化率接近 0
- 超額報酬顯著可能來自 Top-K 放大 + 牛市，而非預測能力

---

## 5. 所需樣本量估計

### 5.1 確認 Live IC 顯著需要多少週？

**已知（156 週數據）**：
- Live IC mean = 0.0051
- Live IC std = 0.0632
- Live ICIR = 0.08

**公式**：
```
n = (z_α / ICIR)²
n = (1.645 / 0.08)² = 409 週（約 7.9 年）
```

**結論**：以目前的 ICIR 水平，需要 **409 週**才能達到 p < 0.05

### 5.2 達到 80% 檢定力需要多少週？

```
n = [(z_α + z_β) / ICIR]²
n = [(1.645 + 0.84) / 0.08]² = 934 週（約 18 年）
```

**結論**：需要 **934 週**才有 80% 把握確認效果——這在實務上**不可行**

### 5.3 目前 156 週是否足夠？

| 問題 | 當前 n | 需要 n | 結論 |
|------|--------|--------|------|
| Live IC > 0？ | 156 | 409 | ❌ **遠不足** |
| 超額報酬 > 0？ | 156 | ~40 | ✅ **綽綽有餘** |
| Valid IC > 0？ | 156 | ~15 | ✅ 足夠 |

### 5.4 實務意涵

**Live IC 無法在合理時間內驗證**：
- 即使三年數據（156 週），仍只完成 38%（156/409）
- 要達到 80% 檢定力需要 18 年，市場早已改變

**結論**：
- **不應期待 Live IC 顯著性**——以目前 ICIR 水平無法達成
- **應關注超額報酬**——這是唯一可驗證的指標
- 如果 Live IC 要在 2-3 年內可驗證，ICIR 需提升至 **0.3** 以上

---

## 6. 優秀與不足分析

### 6.1 哪裡優秀？為什麼？

| 項目 | 數值 | 為什麼優秀 |
|------|------|-----------|
| **超額報酬** | 92.26% | 高度顯著 (p=0.00013) |
| **勝週率** | 61.6% | 顯著超過隨機 50% (t=3.93) |
| **Valid ICIR** | 1.43 | 超過 0.5 基準 |
| **Valid IC 正值率** | 90.4% | 訓練穩定 |

**優秀的根本原因**：
1. Top-K 選股機制能放大微弱信號
2. 牛市環境（3 年累積市場報酬 +84%）有利策略
3. 訓練方法正確（Spearman + CSRankNorm）

**但需謹慎**：
- 超額報酬顯著**不等於**預測能力顯著
- 可能是 Top-K 放大 + 運氣的結果

### 6.2 哪裡不足？為什麼？

| 項目 | 數值 | 為什麼不足 |
|------|------|-----------|
| **Live ICIR** | 0.08 | 遠低於 0.5 基準，接近 0 |
| **Live IC p 值** | 0.318 | 156 週仍無法確認預測能力 |
| **Live IC 正值率** | 54.6% | 幾乎等於擲硬幣 |
| **ICIR 衰減** | 94.3% | 訓練→實盤轉化幾乎失敗 |
| **Valid-Live 相關** | -0.01 | 驗證期**完全**無法預測實盤 |

**不足的根本原因**：

| 問題 | 根本原因 | 證據 |
|------|---------|------|
| Live ICIR 接近 0 | 預測能力本身很弱或不存在 | Live IC mean = 0.005 |
| ICIR 衰減 94% | 驗證期與實盤環境差異太大 | Valid-Live r = -0.01 |
| | 模型只學到驗證期特有模式 | 各年度表現差異極大 |
| | 市場結構快速變化 | 驗證期 100 天已過時 |

---

## 7. 改進方案

### 7.1 短期措施（1-2 週）

| 措施 | 預期效果 | 風險 |
|------|---------|------|
| 縮短驗證期 100 → 30 天 | ICIR 衰減 ↓ | 驗證樣本過少 |
| 增加 Embargo 7 → 14 天 | 減少 lookahead | 減少訓練數據 |
| 監控 5 週滾動 ICIR | 更快發現問題 | 無 |

### 7.2 中期架構改進（1-2 月）

| 措施 | 預期效果 | 實現複雜度 |
|------|---------|-----------|
| 增量學習（每日微調） | Live IC 穩定性 ↑ | 中 |
| Purged K-Fold 驗證 | 減少過擬合 | 高 |
| 動態因子權重 | 適應市場變化 | 中 |

### 7.3 長期研究方向（3-6 月）

| 措施 | 預期效果 | 實現複雜度 |
|------|---------|-----------|
| Ensemble 多模型組合 | 降低單模型風險 | 高 |
| Online Learning | 實時適應市場 | 很高 |
| 因子輪換機制 | 淘汰失效因子 | 中 |

---

## 8. 結論

### 8.1 整體評價

| 面向 | 評價 | 說明 |
|------|------|------|
| **訓練品質** | ⭐⭐⭐⭐ | Valid ICIR 1.43，良好 |
| **實盤預測** | ⭐ | Live ICIR 0.08，幾乎無效 |
| **實際報酬** | ⭐⭐⭐⭐⭐ | 超額報酬高度顯著 |
| **統計可信度** | ⭐⭐ | 報酬可信，但 IC 無法確認 |

### 8.2 核心洞察

1. **預測能力存疑，但策略有效**
   - Live IC 統計上等同於 0（p = 0.32）
   - 但超額報酬高度顯著（p = 0.00013）
   - **可能是 Top-K 放大微弱信號 + 牛市的結果**

2. **驗證期完全無法預測實盤**
   - Valid-Live 相關 r = -0.01
   - Valid ICIR 高不代表 Live ICIR 會高
   - **訓練得再好也無濟於事**

3. **Live IC 在實務上無法驗證**
   - 需要 409 週（7.9 年）才能確認 p < 0.05
   - 這超出任何實用時間範圍
   - **應放棄 Live IC 作為評估指標**

4. **超額報酬是唯一可信指標**
   - 156 週已足夠驗證（p = 0.00013）
   - 但需警惕：2023 年超額報酬**不顯著**（p = 0.20）
   - **可能有 1/3 的年份只是運氣**

### 8.3 下一步行動

1. **放棄優化 Live IC**：投入產出比太低
2. **專注超額報酬穩定性**：監控滾動超額報酬
3. **改進驗證方法**：縮短驗證期 100 → 30 天
4. **考慮增量學習**：讓模型適應近期市場
5. **風險控制**：設置超額報酬觸發警報（如連續 4 週負超額）

---

## 附錄

### A. IC 計算代碼位置

| 功能 | 檔案 | 行號 |
|------|------|------|
| Label 定義 | `model_trainer.py` | 256 |
| Label 標準化 | `model_trainer.py` | 314, 372 |
| IC 計算（訓練） | `model_trainer.py` | 613-618 |
| IC 計算（Live） | `walk_forward_backtester.py` | 476-481 |
| ICIR 計算 | `model_trainer.py` | 1167-1176 |

### B. 文獻引用

1. **Grinold, R. C., & Kahn, R. N. (2000)**. *Active Portfolio Management*. McGraw-Hill.
   - IC/ICIR 標準定義
   - ICIR > 0.5 為可用基準

2. **Microsoft Qlib (2020)**. *Qlib: An AI-oriented Quantitative Investment Platform*. arXiv:2009.11189.
   - 日級 Spearman IC
   - CSRankNorm 標準化

3. **Poh, D., et al. (2021)**. *Building Cross-Sectional Systematic Strategies By Learning to Rank*. Journal of Financial Data Science.
   - 排名預測優於收益預測

4. **López de Prado, M. (2018)**. *Advances in Financial Machine Learning*. Wiley.
   - Walk-Forward 驗證
   - IC Decay 分析

5. **Harvey, C. R., Liu, Y., & Zhu, H. (2016)**. *...and the Cross-Section of Expected Returns*. Review of Financial Studies.
   - 統計顯著性標準

### C. 原始數據表（156 週，2023-2025）

#### Valid IC 分佈

| 統計量 | 數值 |
|--------|------|
| 樣本數 | 156 |
| 平均值 | 0.0274 |
| 標準差 | 0.0192 |
| 中位數 | 0.0288 |
| Q1 | 0.0141 |
| Q3 | 0.0410 |
| 最小值 | -0.0260 |
| 最大值 | 0.0771 |
| ICIR | 1.43 |
| 正值率 | 90.4% |
| t 統計量 | 17.83 |
| p 值 | < 0.0001 |

#### Live IC 分佈

| 統計量 | 數值 |
|--------|------|
| 樣本數 | 152 |
| 平均值 | 0.0051 |
| 標準差 | 0.0632 |
| 中位數 | 0.0053 |
| Q1 | -0.0311 |
| Q3 | 0.0448 |
| 最小值 | -0.2492 |
| 最大值 | 0.1580 |
| ICIR | 0.08 |
| 正值率 | 54.6% |
| t 統計量 | 1.00 |
| p 值 | 0.318 |
| 95% CI | [-0.005, 0.015] |

#### 報酬分佈

| 統計量 | 模型報酬 | 市場報酬 | 超額報酬 |
|--------|---------|---------|---------|
| 樣本數 | 151 | 151 | 151 |
| 平均週報酬 | 1.17% | 0.56% | 0.61% |
| 標準差 | - | - | 1.91% |
| 累積 | 176.43% | 84.17% | 92.26% |
| 勝週數 | - | - | 93 (61.6%) |
| t 統計量 | - | - | 3.93 |
| p 值 | - | - | 0.00013 |

#### 各年度摘要

| 年度 | Valid ICIR | Live ICIR | Live IC p | 累積超額 | 超額 p | 勝週率 |
|------|-----------|-----------|-----------|---------|--------|--------|
| 2023 | 2.63 | -0.00 | 0.994 | 19.8% | 0.204 | 57% |
| 2024 | 0.83 | 0.10 | 0.458 | 25.3% | 0.014 | 65% |
| 2025 | 1.85 | 0.17 | 0.240 | 47.2% | 0.002 | 63% |
| **合計** | **1.43** | **0.08** | **0.318** | **92.3%** | **0.00013** | **62%** |
